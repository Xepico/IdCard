<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student ID Karta Generatori</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #e0e0e0;
            --card-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 10px 40px rgba(0,0,0,0.1);
            --input-bg: #ffffff;
            --button-bg: #667eea;
            --button-hover: #5568d3;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --border-color: #2d3748;
            --card-bg: linear-gradient(135deg, #434343 0%, #000000 100%);
            --shadow: 0 10px 40px rgba(0,0,0,0.5);
            --input-bg: #2d3748;
            --button-bg: #667eea;
            --button-hover: #5568d3;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .language-selector {
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .language-selector:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            background: var(--button-bg);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .theme-toggle:hover {
            background: var(--button-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section, .preview-section {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        input[type="text"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: var(--button-bg);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .file-input-label:hover {
            background: var(--button-hover);
            transform: translateY(-2px);
        }

        .preview-image {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            object-fit: cover;
            margin-top: 10px;
            border: 3px solid var(--border-color);
        }

        .student-card {
            background: var(--card-bg);
            width: 350px;
            height: 220px;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            margin: 0 auto;
        }

        .student-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-logo {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .card-photo {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            object-fit: cover;
            border: 3px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
        }

        .card-content {
            color: white;
        }

        .card-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card-info {
            font-size: 0.85rem;
            margin-bottom: 4px;
            opacity: 0.95;
        }

        .card-id {
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-size: 0.75rem;
            opacity: 0.7;
            color: white;
        }

        .download-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-width: 400px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--border-color);
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .loading-step {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .success-icon {
            font-size: 4rem;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.5rem;
            }

            .student-card {
                width: 100%;
                max-width: 350px;
            }

            .header-controls {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="title">🎓 Student ID Karta Generatori</h1>
            <div class="header-controls">
                <select class="language-selector" id="languageSelector" onchange="changeLanguage()">
                    <option value="uz">🇺🇿 O'zbekcha</option>
                    <option value="en">🇬🇧 English</option>
                    <option value="ru">🇷🇺 Русский</option>
                </select>
                <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
            </div>
        </header>

        <div class="main-content">
            <div class="form-section">
                <h2 data-i18n="formTitle">Ma'lumotlarni kiriting</h2>
                
                <div class="form-group">
                    <label for="studentName" data-i18n="labelName">Talaba ismi</label>
                    <input type="text" id="studentName" data-i18n-placeholder="placeholderName" placeholder="Ism Familiya" oninput="updateCard()">
                </div>

                <div class="form-group">
                    <label for="studentId" data-i18n="labelId">Student ID</label>
                    <input type="text" id="studentId" placeholder="ID123456" oninput="updateCard()">
                </div>

                <div class="form-group">
                    <label for="faculty" data-i18n="labelFaculty">Fakultet</label>
                    <input type="text" id="faculty" data-i18n-placeholder="placeholderFaculty" placeholder="Informatika va Texnologiyalar" oninput="updateCard()">
                </div>

                <div class="form-group">
                    <label for="course" data-i18n="labelCourse">Kurs</label>
                    <select id="course" onchange="updateCard()">
                        <option value="1" data-i18n="course1">1-kurs</option>
                        <option value="2" data-i18n="course2">2-kurs</option>
                        <option value="3" data-i18n="course3">3-kurs</option>
                        <option value="4" data-i18n="course4">4-kurs</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="validUntil" data-i18n="labelValid">Amal qilish muddati</label>
                    <input type="date" id="validUntil" oninput="updateCard()">
                </div>

                <div class="form-group">
                    <label data-i18n="labelPhoto">Rasm yuklash</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="photoUpload" accept="image/*" onchange="handlePhoto(event)">
                        <label for="photoUpload" class="file-input-label">
                            <span data-i18n="btnUpload">📷 Rasm tanlang</span>
                        </label>
                    </div>
                    <img id="previewPhoto" class="preview-image" style="display:none;">
                </div>
            </div>

            <div class="preview-section">
                <h2 data-i18n="previewTitle">Ko'rinishi</h2>
                <div id="studentCard" class="student-card">
                    <div class="card-header">
                        <div class="card-logo">UNIVERSITY</div>
                        <img id="cardPhoto" class="card-photo" src="" alt="">
                    </div>
                    <div class="card-content">
                        <div class="card-name" id="cardName" data-i18n="defaultName">Talaba ismi</div>
                        <div class="card-info">📚 <span id="cardFaculty" data-i18n="defaultFaculty">Fakultet</span></div>
                        <div class="card-info">🎓 <span id="cardCourse">1</span><span data-i18n="courseSuffix">-kurs</span></div>
                        <div class="card-info">📅 <span id="cardValid">2025</span> <span data-i18n="validUntil">gacha</span></div>
                    </div>
                    <div class="card-id" id="cardId">ID: 000000</div>
                </div>
                <button class="download-btn" onclick="downloadCard()">
                    <span data-i18n="btnDownload">⬇️ Kartani yuklash</span>
                </button>
            </div>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div id="spinnerDiv" class="spinner"></div>
            <div id="successIcon" class="success-icon" style="display:none;">✅</div>
            <div class="loading-text" id="loadingText" data-i18n="loadingText">Karta tayyorlanmoqda...</div>
            <div class="loading-step" id="loadingStep" data-i18n="loadingStep">Iltimos kuting</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const translations = {
            uz: {
                title: "🎓 Student ID Karta Generatori",
                formTitle: "Ma'lumotlarni kiriting",
                labelName: "Talaba ismi",
                placeholderName: "Ism Familiya",
                labelId: "Student ID",
                labelFaculty: "Fakultet",
                placeholderFaculty: "Informatika va Texnologiyalar",
                labelCourse: "Kurs",
                course1: "1-kurs",
                course2: "2-kurs",
                course3: "3-kurs",
                course4: "4-kurs",
                labelValid: "Amal qilish muddati",
                labelPhoto: "Rasm yuklash",
                btnUpload: "📷 Rasm tanlang",
                previewTitle: "Ko'rinishi",
                defaultName: "Talaba ismi",
                defaultFaculty: "Fakultet",
                courseSuffix: "-kurs",
                validUntil: "gacha",
                btnDownload: "⬇️ Kartani yuklash",
                loadingText: "Karta tayyorlanmoqda...",
                loadingStep: "Iltimos kuting",
                step1: "1/3 - Ma'lumotlar tekshirilmoqda",
                step2: "2/3 - Karta dizayni yaratilmoqda",
                step3: "3/3 - Rasm formatga o'zgartrilmoqda",
                ready: "Tayyor!",
                downloading: "Karta yuklab olinmoqda...",
                error: "Xatolik yuz berdi!",
                tryAgain: "Iltimos qaytadan urinib ko'ring"
            },
            en: {
                title: "🎓 Student ID Card Generator",
                formTitle: "Enter Information",
                labelName: "Student Name",
                placeholderName: "Full Name",
                labelId: "Student ID",
                labelFaculty: "Faculty",
                placeholderFaculty: "Information Technology",
                labelCourse: "Course",
                course1: "1st Year",
                course2: "2nd Year",
                course3: "3rd Year",
                course4: "4th Year",
                labelValid: "Valid Until",
                labelPhoto: "Upload Photo",
                btnUpload: "📷 Choose Photo",
                previewTitle: "Preview",
                defaultName: "Student Name",
                defaultFaculty: "Faculty",
                courseSuffix: " Year",
                validUntil: "until",
                btnDownload: "⬇️ Download Card",
                loadingText: "Preparing card...",
                loadingStep: "Please wait",
                step1: "1/3 - Checking data",
                step2: "2/3 - Creating card design",
                step3: "3/3 - Converting to image",
                ready: "Ready!",
                downloading: "Downloading card...",
                error: "An error occurred!",
                tryAgain: "Please try again"
            },
            ru: {
                title: "🎓 Генератор студенческих ID карт",
                formTitle: "Введите данные",
                labelName: "Имя студента",
                placeholderName: "Полное имя",
                labelId: "Студенческий ID",
                labelFaculty: "Факультет",
                placeholderFaculty: "Информационные технологии",
                labelCourse: "Курс",
                course1: "1-й курс",
                course2: "2-й курс",
                course3: "3-й курс",
                course4: "4-й курс",
                labelValid: "Действителен до",
                labelPhoto: "Загрузить фото",
                btnUpload: "📷 Выбрать фото",
                previewTitle: "Предпросмотр",
                defaultName: "Имя студента",
                defaultFaculty: "Факультет",
                courseSuffix: "-й курс",
                validUntil: "до",
                btnDownload: "⬇️ Скачать карту",
                loadingText: "Подготовка карты...",
                loadingStep: "Пожалуйста, подождите",
                step1: "1/3 - Проверка данных",
                step2: "2/3 - Создание дизайна карты",
                step3: "3/3 - Конвертация в изображение",
                ready: "Готово!",
                downloading: "Загрузка карты...",
                error: "Произошла ошибка!",
                tryAgain: "Пожалуйста, попробуйте снова"
            }
        };

        let currentLang = 'uz';
        let photoData = null;

        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeBtn.textContent = '🌙';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeBtn.textContent = '☀️';
            }
        }

        function changeLanguage() {
            currentLang = document.getElementById('languageSelector').value;
            updateTranslations();
            updateCard();
        }

        function updateTranslations() {
            const lang = translations[currentLang];
            
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (lang[key]) {
                    element.textContent = lang[key];
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (lang[key]) {
                    element.placeholder = lang[key];
                }
            });
        }

        function handlePhoto(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    photoData = event.target.result;
                    document.getElementById('previewPhoto').src = photoData;
                    document.getElementById('previewPhoto').style.display = 'block';
                    document.getElementById('cardPhoto').src = photoData;
                };
                reader.readAsDataURL(file);
            }
        }

        function updateCard() {
            const lang = translations[currentLang];
            const name = document.getElementById('studentName').value || lang.defaultName;
            const id = document.getElementById('studentId').value || '000000';
            const faculty = document.getElementById('faculty').value || lang.defaultFaculty;
            const course = document.getElementById('course').value;
            const validDate = document.getElementById('validUntil').value;

            document.getElementById('cardName').textContent = name;
            document.getElementById('cardId').textContent = 'ID: ' + id;
            document.getElementById('cardFaculty').textContent = faculty;
            document.getElementById('cardCourse').textContent = course;
            
            if (validDate) {
                const date = new Date(validDate);
                const year = date.getFullYear();
                document.getElementById('cardValid').textContent = year + ' ' + lang.validUntil;
            }
        }

        function downloadCard() {
            const lang = translations[currentLang];
            const card = document.getElementById('studentCard');
            const overlay = document.getElementById('loadingOverlay');
            const spinnerDiv = document.getElementById('spinnerDiv');
            const successIcon = document.getElementById('successIcon');
            const loadingText = document.getElementById('loadingText');
            const loadingStep = document.getElementById('loadingStep');
            const downloadBtn = document.querySelector('.download-btn');
            
            downloadBtn.disabled = true;
            overlay.classList.add('active');
            loadingText.textContent = lang.loadingText;
            loadingStep.textContent = lang.step1;
            
            setTimeout(() => {
                loadingStep.textContent = lang.step2;
                
                setTimeout(() => {
                    loadingStep.textContent = lang.step3;
                    
                    html2canvas(card, {
                        scale: 3,
                        backgroundColor: null,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    }).then(canvas => {
                        spinnerDiv.style.display = 'none';
                        successIcon.style.display = 'block';
                        loadingText.textContent = lang.ready;
                        loadingStep.textContent = lang.downloading;
                        
                        const link = document.createElement('a');
                        const studentName = document.getElementById('studentName').value || 'student';
                        const studentId = document.getElementById('studentId').value || 'id';
                        link.download = `student-card-${studentName.replace(/\s+/g, '-')}-${studentId}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        
                        setTimeout(() => {
                            overlay.classList.remove('active');
                            spinnerDiv.style.display = 'block';
                            successIcon.style.display = 'none';
                            downloadBtn.disabled = false;
                            loadingText.textContent = lang.loadingText;
                            loadingStep.textContent = lang.loadingStep;
                        }, 1500);
                    }).catch(error => {
                        console.error('Error:', error);
                        loadingText.textContent = lang.error;
                        loadingStep.textContent = lang.tryAgain;
                        downloadBtn.disabled = false;
                        
                        setTimeout(() => {
                            overlay.classList.remove('active');
                            loadingText.textContent = lang.loadingText;
                            loadingStep.textContent = lang.loadingStep;
                        }, 2000);
                    });
                }, 800);
            }, 800);
        }

        // Bugungi sanadan 1 yil keyingi sanani o'rnatish
        const today = new Date();
        const nextYear = new Date(today.setFullYear(today.getFullYear() + 1));
        document.getElementById('validUntil').value = nextYear.toISOString().split('T')[0];
        updateCard();
    </script>
</body>
</html>